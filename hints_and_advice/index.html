<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Hints and advice - AgenaScript Documentation</title>
  

  <link rel="shortcut icon" href="../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Hints and advice";
    var mkdocs_page_input_path = "hints_and_advice.md";
    var mkdocs_page_url = "/hints_and_advice/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AgenaScript Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Lets start</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../handling_bars_and_instruments/">Handling bars and instruments</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../events/">Events</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../strategy_programming/">Strategy programming</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../keywords/">Keywords</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../drawing_objects/">Drawing objects</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Hints and advice</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#hints-advice">Hints &amp; Advice</a></li>
                
                    <li><a class="toctree-l4" href="#bar-numbering-within-the-chart">Bar Numbering Within the Chart</a></li>
                
                    <li><a class="toctree-l4" href="#custom-chart-background-image">Custom Chart Background Image</a></li>
                
                    <li><a class="toctree-l4" href="#file-selection-in-the-properties">File Selection in the Properties</a></li>
                
                    <li><a class="toctree-l4" href="#formatting-of-numbers">Formatting of Numbers</a></li>
                
                    <li><a class="toctree-l4" href="#index-conversion">Index Conversion</a></li>
                
                    <li><a class="toctree-l4" href="#overwriting-indicator-names">Overwriting Indicator Names</a></li>
                
                    <li><a class="toctree-l4" href="#rectangle-with-rounded-corners">Rectangle with Rounded Corners</a></li>
                
            
            </ul>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AgenaScript Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Hints and advice</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="hints-advice">Hints &amp; Advice</h1>
<h2 id="bar-numbering-within-the-chart">Bar Numbering Within the Chart</h2>
<p>The following example demonstrates the usage of the plot method and the properties of the [<em>ChartControl</em>] object.</p>
<p><img alt="Bar Numbering Within the Chart" src="../media/image30.png" /></p>
<p><strong>Note:</strong>
For demonstration purposes, each time Paint is called up within the “Bar Numbering” section, “New” and “Dispose” will also be called up multiple times.
From a performance point of view, this solution can be better implemented by using constant variable declarations and calling up “Dispose” within the OnTermination statement.</p>
<pre><code class="cs">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Linq;
using System.Xml;
using System.Xml.Serialization;
using AgenaTrader.API;
using AgenaTrader.Custom;
using AgenaTrader.Plugins;
using AgenaTrader.Helper;
namespace AgenaTrader.UserCode
{
[Description(&quot;PlotSample&quot;)]
public class PlotSample : UserIndicator
{
Pen pen = new Pen(Color.Blue);
StringFormat sf = new StringFormat();
SolidBrush brush = new SolidBrush(Color.Black);
Font font = new Font(&quot;Arial&quot;, 10, FontStyle.Bold);
protected override void Initialize()
{
Overlay = true;
}
protected override void OnTermination()
{
if (pen!=null) pen.Dispose();
if (sf!=null) sf.Dispose();
if (brush!=null) brush.Dispose();
if (font!=null) font.Dispose();
}
protected override void OnBarUpdate()
{}
public override void Plot(Graphics g, Rectangle r, double min, double max)
{
if (Bars == null || ChartControl == null) return;
// Properties of ChartControl
string s;
s = &quot;bounds: &quot;+r.X.ToString()+&quot; &quot;+r.Y.ToString()+&quot; &quot;+r.Height.ToString()+&quot; &quot;+r.Width.ToString();
g.DrawString(s, font, brush, 10, 50, sf);
s = &quot;min: &quot;+Instrument.Round2TickSize(min).ToString()+&quot; max: &quot;+Instrument.Round2TickSize(max).ToString();
g.DrawString(s, font, brush, 10, 70, sf);
s = &quot;BarSpace: &quot;+ChartControl.BarSpace.ToString()+&quot; BarWidth: &quot;+ChartControl.BarWidth.ToString();
g.DrawString(s, font, brush, 10, 90, sf);
s = &quot;Bars.Count: &quot;+Bars.Count.ToString();
g.DrawString(s, font, brush, 10, 110, sf);
s = &quot;BarsPainted: &quot;+ChartControl.BarsPainted.ToString() + &quot; FirstBarPainted: &quot;+ChartControl.FirstBarPainted.ToString() + &quot; LastBarPainted: &quot;+ChartControl.LastBarPainted.ToString();
g.DrawString(s, font, brush, 10, 130, sf);
s = &quot;BarsVisible: &quot;+ChartControl.BarsVisible.ToString() + &quot; FirstBarVisible: &quot;+ChartControl.FirstBarVisible.ToString() + &quot; LastBarVisible: &quot;+ChartControl.LastBarVisible.ToString();
g.DrawString(s, font, brush, 10, 150, sf);
// Bar numbering
StringFormat _sf = new StringFormat();
SolidBrush _brush = new SolidBrush(Color.Blue);
Font _font = new Font(&quot;Arial&quot;, 8);
SizeF _stringSize = new SizeF();
_sf.Alignment = StringAlignment.Center;
for (int i=ChartControl.FirstBarVisible; i&lt;=ChartControl.LastBarVisible; i++)
{
string text = i.ToString();
_stringSize = g.MeasureString(text, _font);
int x = ChartControl.GetXByBarIdx(Bars, i);
int y = ChartControl.GetYByValue(this, High[Abs2Ago(i)] + 3*TickSize) - (int) _stringSize.Height;
g.DrawString(text, _font, _brush, x, y, _sf);
}
_sf.Dispose();
_brush.Dispose();
_font.Dispose();
}
private int Abs2Ago(int idx)
{
return Math.Max(0,Bars.Count-idx-1-(CalculateOnBarClose?1:0));
}
}
}
</code></pre>

<h2 id="custom-chart-background-image">Custom Chart Background Image</h2>
<p>The plot method allows you to add a background image to the chart.
The following example uses an image with the JPG format located in the main directory on the hard drive (C:).</p>
<pre><code class="cs">using System;
using System.Drawing;
using AgenaTrader.Custom;
using AgenaTrader.Plugins;
namespace AgenaTrader.UserCode
{
public class BackgroundPicture : UserIndicator
{
Image img;
protected override void OnStartUp()
{
try { img = Image.FromFile(&quot;C:\\\\MyCar.jpg&quot;); } catch {}
}
public override void Plot(Graphics g, Rectangle r, double min, double max)
{
if (ChartControl == null || img == null) return;
g.DrawImage(img,r);
}
}
}
</code></pre>

<p><img alt="Custom Chart Background Image" src="../media/image31.png" /></p>
<h2 id="file-selection-in-the-properties">File Selection in the Properties</h2>
<p>To enable file selection within the properties dialog of an indicator, you will need a type converter.
The following example displays how a selection of WAV files can be programmed for an alert:</p>
<pre><code class="cs">using System;
using System.IO;
using System.Collections;
using System.ComponentModel;
using AgenaTrader.Custom;
using AgenaTrader.Plugins;
namespace AgenaTrader.UserCode
{
[Description(&quot;File Picker Example.&quot;)]
public class FilePicker : UserIndicator
{
private string _soundFile = &quot;Alert4.wav&quot;;
private static string _dir = Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments) + @&quot;\\AgenaTrader\\Sounds\\&quot;;
internal class MyConverter : TypeConverter
{
public override bool GetStandardValuesSupported(ITypeDescriptorContext context)
{
return true;
}
public override StandardValuesCollection GetStandardValues(ITypeDescriptorContext context)
{
if (context == null) return null;
ArrayList list = new ArrayList();
DirectoryInfo dir = new DirectoryInfo(_dir);
FileInfo[] files = dir.GetFiles(&quot;*.wav&quot;);
foreach (FileInfo file in files) list.Add(file.Name);
return new TypeConverter.StandardValuesCollection(list);
}
}
protected override void OnStartUp()
{
PlaySound(_soundFile);
}
[Description(&quot;Choose file to play.&quot;)]
[Category (&quot;Sound&quot;)]
[TypeConverter(typeof(MyConverter))]
public string SoundFile
{
get { return _soundFile; }
set { _soundFile = value; }
}
}
}
</code></pre>

<h2 id="formatting-of-numbers">Formatting of Numbers</h2>
<h3 id="formatting-of-numbers_1">Formatting of Numbers</h3>
<p><strong>General information on formatting in C#</strong></p>
<pre><code class="cs">double d = 123.4567890;
Print(&quot;Without formatting : &quot; + d.ToString()); // 123.456789
Print(&quot;As a currency : &quot; + d.ToString(&quot;C&quot;)); // 123.46 €
Print(&quot;Exponential : &quot; + d.ToString(&quot;E&quot;)); // 1.234568E+002
Print(&quot;As a fixed point : &quot; + d.ToString(&quot;F2&quot;)); // 123.46
Print(&quot;General : &quot; + d.ToString(&quot;G&quot;)); // 123.456789
Print(&quot;As a percentage : &quot; + d.ToString(&quot;P0&quot;)); // 12.346%
Print(&quot;To 2 decimal places : &quot; + d.ToString(&quot;N2&quot;)); // 123.45
Print(&quot;To 3 decimal places : &quot; + d.ToString(&quot;N3&quot;)); // 123.457
Print(&quot;To 4 decimal places : &quot; + d.ToString(&quot;N4&quot;)); // 123.4568
</code></pre>

<h3 id="useful-functions">Useful Functions</h3>
<p>Returns the currency symbol for the current instrument:</p>
<pre><code class="cs">public string getWaehrungssymbol() {
string s = &quot;&quot;;
switch (Instrument.Currency) {
case Currencies.USD : s = &quot;$&quot;; break;
case Currencies.EUR : s = &quot;€&quot;; break;
case Currencies.CHF : s = &quot;CHF&quot;; break;
case Currencies.GBP : s = ((char)163).ToString(); break;
case Currencies.JPY : s = ((char)165).ToString(); break;
}
return s;
}
</code></pre>

<p>Converts a number into a currency with a thousands separator and 2 decimal places.
The block separation per 1000 units can be set in “Culture”.</p>
<pre><code class="cs">public string getWaehrungOhneSymbol(double d) {
// Separate 1000s and two decimal points
return d.ToString(&quot;\#,\#\#0.00&quot;);
}
</code></pre>

<p>Converts a number into a currency with a thousands separator and 2 decimal places and a currency symbol:</p>
<pre><code class="cs">public string getWaehrungMitSymbol(double d) {
// Dollar is prefixed, everything else is added afterwards
string s=getWaehrungOhneSymbol(d);
string w=getWaehrungssymbol();
if (w==&quot;$&quot;) s=w+&quot; &quot;+s; else s+=&quot; &quot;+w;
return s;
}
</code></pre>

<p>Converts a number into a currency with a thousands separator and 2 decimal places as well as a currency symbol, and fills up to a fixed length with empty spaces.
The function is great for outputting values into a table.</p>
<pre><code class="cs">public string getWaehrungMitSymbol(double d, int Laenge) {
// Leading spaces until a fixed length has been reached
string s=getWaehrungMitSymbol(d);
for (int i=s.Length; i&lt;Laenge; i++) s=&quot; &quot;+s;
return s;
}
</code></pre>

<p>Converts a number into a percentage. Nothing is calculated, only formatted.
Leading plus sign, a decimal place and a percent sign.</p>
<pre><code class="cs">public string getPercent(double d) {
d=Math.Round(d, 1);
string s=(d&gt;0)?&quot;+&quot;:&quot;&quot;; // Leading plus sign
return s+d.ToString(&quot;0.0&quot;)+&quot;%&quot;;
}
</code></pre>

<p>Formats the market price depending on the number of decimal places to which the currency is notated.
This includes a thousands separator and fixed length, meaning that zeros are filled on the right hand side.
Because Culture Info is being used, you must integrate the NameSpace <strong>System.Globalization</strong>.</p>
<pre><code class="cs">public string format(double d)
{
int tickLength = 0;
// ticksize.ToString() is for example 6J = &quot;1E-06&quot; and length is then 5
// and not 8 as it should be with &quot;0.000001&quot;)
if (TickSize &lt; 1) tickLength = TickSize.ToString(&quot;0.\#\#\#\#\#\#\#\#\#\#\#&quot;).Length - 2;
string f = &quot;{0:n&quot;+tickLength.ToString()+&quot;}&quot;;
return string.Format(CultureInfo.CurrentCulture, f, d);
}
</code></pre>

<h3 id="example"><strong>Example</strong></h3>
<pre><code class="cs">double profit = 1234.567890;
Print(&quot;getCurrencyWithoutSymbol &quot;: + getWaehrungOhneSymbol(Gewinn)); // 1234.57
Print(&quot;getCurrencyWithSymbol :&quot; + getWaehrungMitSymbol(Gewinn)); // $ 1,234.57
Print(&quot;getCurrencyWithSymbol :&quot; + getWaehrungMitSymbol(Gewinn)); // $ 1,234.57
double percentage profit = 12.3456789;
Print(&quot;getPercent :&quot; + getPercent(ProzGewinn)); // +12.3%
double price = 123.4567;
Print(&quot;getPrice :&quot; + getKurs(Kurs)); // 123.46
</code></pre>

<h2 id="index-conversion">Index Conversion</h2>
<p>There are two types of indexing in AgenaTrader.</p>
<ol>
<li>
<p>The bars are numbered from youngest to oldest.
This type is used in the OnBarUpdate() method.
The last bar has an index of 0, while the oldest bar has the index Bars.Count-1.</p>
</li>
<li>
<p>The bars are numbered from oldest to youngest.
This type is most commonly used in the Plot() method in “for” loops.
The oldest Bbar receives an index of 0, while the youngest bar has the index Bars.Count-1.
The following function can be used to recalculate the index types:</p>
</li>
</ol>
<pre><code class="cs">private int Convert(int idx)
{
return Math.Max(0,Bars.Count-idx-1-(CalculateOnBarClose?1:0));
}
</code></pre>

<h2 id="overwriting-indicator-names">Overwriting Indicator Names</h2>
<p>The name of an indicator (or a strategy) is displayed within the properties dialog and at the top edge of the chart. Use the ToString() property to overwrite it.</p>
<pre><code class="cs">public override string ToString()
{
return &quot;My Name&quot;;
}
</code></pre>

<h2 id="rectangle-with-rounded-corners">Rectangle with Rounded Corners</h2>
<p>By using the graphics methods, you can create interesting forms and place them onto the chart.
One example of this is the RoundedRectangle class, which is a rectangle with rounded corners.</p>
<p><img alt="Rectangle with Rounded Corners" src="../media/image32.png" /></p>
<pre><code class="cs">Example Code:
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Linq;
using System.Xml;
using System.Xml.Serialization;
using System.Drawing.Drawing2D;
using AgenaTrader.API;
using AgenaTrader.Custom;
using AgenaTrader.Plugins;
namespace AgenaTrader.UserCode
{
[Description(&quot;Demo of RoundedRectangles&quot;)]
public class DemoRoundedRectangle : UserIndicator
{
protected override void Initialize()
{
Overlay = true;
}
protected override void OnBarUpdate() {}
public override void Plot(Graphics g, Rectangle r, double min, double max)
{
GraphicsPath path;
// draws a rectangle with rounded corners
path = RoundedRectangle.Create(30, 50, 100, 100,8);
g.DrawPath(Pens.Black, path);
// draws a filled rectangle with a radius of 20
// only round the upper left and lower right corner
path = RoundedRectangle.Create(160, 50, 100, 100, 20,
RoundedRectangle.RectangleCorners.TopLeft|RoundedRectangle.RectangleCorners.BottomRight);
g.FillPath(Brushes.Orange, path);
}
}
public abstract class RoundedRectangle
{
public enum RectangleCorners
{
None = 0, TopLeft = 1, TopRight = 2, BottomLeft = 4, BottomRight = 8,
All = TopLeft | TopRight | BottomLeft | BottomRight
}
public static GraphicsPath Create(int x, int y, int width, int height, int radius, RectangleCorners corners)
{
Rectangle r = new Rectangle(x,y,width, height);
Rectangle tlc = new Rectangle(r.Left, r.Top,Math.Min(2 * radius, r.Width),Math.Min(2 * radius, r.Height));
Rectangle trc = tlc;
trc.X = r.Right - 2 * radius;
Rectangle blc = tlc;
blc.Y = r.Bottom - 2 * radius;
Rectangle brc = blc;
brc.X = r.Right - 2 * radius;
Point[] n = new Point[]
{
new Point(tlc.Left, tlc.Bottom), tlc.Location,
new Point(tlc.Right, tlc.Top), trc.Location,
new Point(trc.Right, trc.Top),
new Point(trc.Right, trc.Bottom),
new Point(brc.Right, brc.Top),
new Point(brc.Right, brc.Bottom),
new Point(brc.Left, brc.Bottom),
new Point(blc.Right, blc.Bottom),
new Point(blc.Left, blc.Bottom), blc.Location
};
GraphicsPath p = new GraphicsPath();
p.StartFigure();
//Top left corner
if ((RectangleCorners.TopLeft &amp; corners) == RectangleCorners.TopLeft)
p.AddArc(tlc, 180, 90);
else
p.AddLines(new Point[] { n[0], n[1], n[2] });
//Top edge
p.AddLine(n[2], n[3]);
//Top right corner
if ((RectangleCorners.TopRight &amp; corners) == RectangleCorners.TopRight)
p.AddArc(trc, 270, 90);
else
p.AddLines(new Point[] { n[3], n[4], n[5] });
//Right edge
p.AddLine(n[5], n[6]);
//Bottom right corner
if ((RectangleCorners.BottomRight &amp; corners) == RectangleCorners.BottomRight)
p.AddArc(brc, 0, 90);
else
p.AddLines(new Point[] { n[6], n[7], n[8] });
//Bottom edge
p.AddLine(n[8], n[9]);
//Bottom left corner
if ((RectangleCorners.BottomLeft &amp; corners) == RectangleCorners.BottomLeft)
p.AddArc(blc, 90, 90);
else
p.AddLines(new Point[] { n[9], n[10], n[11] });
//Left edge
p.AddLine(n[11], n[0]);
p.CloseFigure();
return p;
}
public static GraphicsPath Create(Rectangle rect, int radius, RectangleCorners c)
{ return Create(rect.X, rect.Y, rect.Width, rect.Height, Math.Max(1,radius), c); }
public static GraphicsPath Create(int x, int y, int width, int height, int radius)
{ return Create(x, y, width, height, Math.Max(1,radius), RectangleCorners.All); }
public static GraphicsPath Create(Rectangle rect, int radius)
{ return Create(rect.X, rect.Y, rect.Width, rect.Height, Math.Max(1,radius)); }
public static GraphicsPath Create(int x, int y, int width, int height)
{ return Create(x, y, width, height, 8); }
public static GraphicsPath Create(Rectangle rect)
{ return Create(rect.X, rect.Y, rect.Width, rect.Height); }
}
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../drawing_objects/" class="btn btn-neutral" title="Drawing objects"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../drawing_objects/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>

</body>
</html>
